<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="org.kh.splendy.mapper.RoomMapper">
	<resultMap id="roomResult" type="org.kh.splendy.vo.Room">
		<result column="RM_ID"			property="id"			javaType="int" />
		<result column="RM_TITLE"		property="title"		javaType="java.lang.String" />
		<result column="RM_PW"			property="password"		javaType="java.lang.String" />
		<result column="RM_HOST"		property="host"			javaType="int" />
		<result column="RM_INFO"		property="info"			javaType="java.lang.String" />
		<result column="RM_PL_LIMITS"	property="playerLimits"	javaType="int" />
		<result column="RM_WINNER"		property="winner"		javaType="int" />
		<result column="RM_START"		property="start"		javaType="java.sql.Date" />
		<result column="RM_END"			property="end"			javaType="java.sql.Date" />
	</resultMap>
	
	<select id="getNotEmptyRoom" resultType="java.util.HashMap">
	<![CDATA[
		SELECT KH_ROOM.RM_ID
		FROM KH_ROOM
			INNER JOIN KH_PLAYER
				ON KH_ROOM.RM_ID = KH_PLAYER.RM_ID
			INNER JOIN KH_USER_INNER
				ON KH_PLAYER.U_ID           = KH_USER_INNER.U_ID
		WHERE KH_PLAYER.PL_IS_IN    > 0
			AND KH_USER_INNER.U_CONNECT > 0
			AND KH_ROOM.RM_ID > 0
		GROUP BY KH_PLAYER.PL_IS_IN,
			KH_USER_INNER.U_CONNECT,
			KH_ROOM.RM_ID
		HAVING COUNT(KH_PLAYER.U_ID) > 0
	]]>
	</select>
</mapper>